<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.project.dao.MemberDao">
	
	
<!--  	<select id="login" resultType="com.team1.project.dto.MemberDTO"> 
 		SELECT * from member
 		where member_id= #{member_id}
	</select>
 -->
	
	<select id="findByEmail" resultType="com.team1.project.dto.MemberDTO">
		select * from
		member
		where email = #{email}
	</select>
	
	
	<!-- 아이디로 회원 찾기 -->
	<select id="findById" resultType="com.team1.project.dto.MemberDTO">
		select * from
		member
		where member_id = #{member_id}
	</select>	
	
	
	<update id="loginCountInc">
		update member set
			loginCount = loginCount + 1
			<choose>
				<when test="loginCount > 5 ">
					, accountLocked = 'Y'
				</when>
				<otherwise>
					, accountLocked = 'N'
				</otherwise>
			</choose>
			where email = #{email}
	</update>
	
	<update id="loginCountClear">
		update member set
			loginCount = 0
			,accountLocked = 'N'
		where email = #{email}  
	</update>
	
	
	   	<insert id="insertMember" >
		insert into member (
			member_id
			,name
			,phone
			,gender
			,email
			,pwd
			,oauth
			,age
			,roles
			,logincnt
			,last_login_time
			,accountexpired
			,accountlocked
			,profile_img

		) values (
			#{member_id}
			,#{name}
			,#{phone}
			,#{gender}
			,#{email}
			,#{pwd}
			,#{oauth}
			,#{age}
			,#{roles}
			,#{loginCnt}
			,#{last_login_time}
			,#{accountExpired}
			,#{accountLocked}
			,#{profile_img}
		) 
	</insert>
	
	<update id="encodingPwd">
		update member set
		pwd = #{pwd}
		where member_id =#{member_id}
	</update>
	
	<!-- 기존 회원인지 체크하기 -->
	<select id="checkMember" resultType="int">
		select count(*) member
		where member_id=#{member_id}
	</select>
	
	<!-- 관리자 -->
	<select id="memberList" parameterType="com.team1.project.dto.MemberDTO" resultType="com.team1.project.dto.MemberDTO">
		SELECT * from member
	</select>
</mapper>